{% extends '::base.html.twig' %}

{% block title %}{{ entity.title }}{% endblock %}

{% block stylesheets %}
    {% stylesheets
    'bundles/amsterdamphpjob/css/rateit.css'
    output = '/css/rateit.css'
    filter = 'cssrewrite'
    debug=false
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}


{% endblock %}

{% block body -%}
<div class="row-fluid">
    <section id="details" class="span8 pull-left" xmlns="http://www.w3.org/1999/html">

        {% if is_granted('OWNER', entity) or is_granted('ROLE_ADMIN') %}
            <div class="owner actions pull-right">
                <form id="formDelete" method="post" action="{{ path('job_delete', {'id':entity.id}) }}" class="">
                    <div class="btn-group">
                        <a class="btn btn-small" href="{{ path('job_edit', {'id':entity.id}) }}"> <i class="icon-edit icon-large"></i> Edit</a>
                        <a href="javascript:void(0)" onclick="$('#formDelete').submit()" class="btn btn-small btn-danger"><i class="icon-trash icon-large"></i> Delete</a>
                    </div>
                </form>
            </div>
        {% endif %}

        <h2>{{ entity.title }}</h2>
        <h4>
            {{ entity.location }} <small>{{ entity.created|date('d-m-Y') }}</small>
            <input type="range" min="0" max="5" value="{{ entity.calculatedRating }}" step="1" id="jobRating">
            <div id="jobRatingWrapper" class="rateit" data-rateit-backingfld="#jobRating"
                 data-rateit-resetable="false" data-jobid="{{ entity.id }}" data-rateit-readonly="{{ ratedJob }}" ></div>
        </h4>

        <div class="details">{{ entity.description | nl2br}}</div>

        <h3>Extra Information</h3>
        <dl class="dl-horizontal">
            <dt>Contract Type</dt>
            <dd>{{ entity.getContractTypeLabel() }}</dd>

            {% if entity.salary is not empty %}
                <dt>Salary</dt>
                <dd>{{ entity.salary }}</dd>
            {% endif %}

            {% if entity.url is not empty %}
                <dt>Url</dt>
                <dd>{{ entity.url }}</dd>
            {% endif %}
        </dl>

        <div class="pull-right">
            <a class="btn  btn-primary contact-recruiter" href="mailto:{{ entity.user.email }}?subject={{entity.title}}">
                <i class="icon-comment icon-large"></i> Contact poster
            </a>
            <p class="text-right">
                <small><a href="{{ path('job_handle_report', { 'id': entity.id }) }}"><i class="icon-warning-sign"></i> Report abuse</a></small>
            </p>
        </div>
    </section>

    <section id="poster" class="span4 pull-right">

        <div class="userActions">

            <a class="btn btn-inverse btn-block" href="mailto:{{ entity.user.email }}?subject={{entity.title}}">
                <i class="icon-envelope"></i> Apply by Email
            </a>

            <a class="btn  btn-info btn-block" href="mailto:{{ entity.user.email }}?subject={{entity.title}}">
                <i class="icon-user"></i> Apply with LinkedIn
            </a>
            
        </div>

        <hr>

            <div class="media">

                <div class="pull-left span3">
                {% if entity.user.companyLogo %}
                    <a href="{{ entity.user.companyUrl }}">
                        <img class="media-object img-rounded" src="{{ entity.user.companyLogo }}" />
                    </a>
                {% else %}
                    <img class="media-object img-rounded" src="{{ gravatar(entity.user.email) }}" />
                {% endif %}
                </div>
                    <div class="media-body">
                        <h4 class="media-heading">{{ entity.user.companyName }}</h4>
                        <p>Contact: {{ entity.user.name }}</p>
                    </div>
                <p class="clearfix"></p>
            </div>

            <blockquote>
                {{ entity.user.companyBio }}
            </blockquote>

    </section>
</div>
{% endblock %}

{% block javascripts %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

    {% javascripts
    '@AmsterdamPHPJobBundle/Resources/public/js/jquery.cookie.js'
    '@AmsterdamPHPJobBundle/Resources/public/js/jquery.rateit.js'
    '@AmsterdamPHPJobBundle/Resources/public/js/jobs.js'
    output = '/js/show.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        var jobRating = new JobRating();
        jobRating.init();
    </script>
{% endblock %}
